<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>AbstractAccount.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">ui</a> &gt; <a href="../index.html" class="el_bundle">core</a> &gt; <a href="index.source.html" class="el_package">core</a> &gt; <span class="el_source">AbstractAccount.java</span></div><h1>AbstractAccount.java</h1><pre class="source lang-java linenums">package core;

import java.util.ArrayList;
import java.util.List;

/**
 * An abstract class for commen methods for the different type accounts to inherit from.
 */
public abstract class AbstractAccount {

  private String name;
  private double balance;
  private final int accountNumber;
  private User owner;
<span class="fc" id="L15">  private List&lt;Transaction&gt; transactionHistory = new ArrayList&lt;&gt;();</span>

  // ==============================================================================================
  // Constructors
  // ==============================================================================================

  /**
   * Top level account which contains all the shared methods like depositing,
   * transfering etc. Cannot create an instance of this top-level account.
   *
   * @param name the name of the account
   * @param accountNumber the account number of the account
   * @param owner the owner of the account
   */
<span class="fc" id="L29">  public AbstractAccount(String name, int accountNumber, User owner) {</span>
<span class="fc" id="L30">    BankHelper.checkIfValidName(name);</span>
<span class="fc" id="L31">    this.name = name;</span>

<span class="fc" id="L33">    BankHelper.checkIfValidAccountNumber(accountNumber);</span>
<span class="fc bfc" id="L34" title="All 2 branches covered.">    if (owner != null) {</span>
<span class="fc" id="L35">      BankHelper.checkIfAccountNumberIsTaken(accountNumber, owner);</span>
    }

<span class="fc" id="L38">    this.accountNumber = accountNumber;</span>

<span class="fc" id="L40">    setOwner(owner);</span>
<span class="fc" id="L41">  }</span>

  /**
   * Top level account which contains all the shared methods like depositing, 
   * transfering etc. Cannot create an instance of this top-level account. 
   * The account number is generated by going from the
   * number 1000 to 9999 and checking for an available account number.
   *
   * @param name the name of the account
   * @param owner the owner of the account
   */
<span class="fc" id="L52">  public AbstractAccount(String name, User owner) {</span>
<span class="fc" id="L53">    BankHelper.checkIfValidName(name);</span>
<span class="fc" id="L54">    this.name = name;</span>

<span class="fc" id="L56">    int availableAccountNumber = getNextAvailableAccountNumber(owner);</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">    if (availableAccountNumber == -1) {</span>
<span class="fc" id="L58">      throw new IllegalStateException(&quot;This user has reached the maximum number of accounts&quot;);</span>
    }
<span class="fc" id="L60">    accountNumber = availableAccountNumber;</span>

<span class="fc" id="L62">    setOwner(owner);</span>
<span class="fc" id="L63">  }</span>



  // ==============================================================================================
  // Functional methods
  // ==============================================================================================

  /**
   * This deposit is the initial deposit when the account is being created.
   *
   * @param amount the amount to be deposited
   * @throws IllegalArgumentException if the given amount is negative
   */
  protected void initialDeposit(double amount) {
<span class="fc" id="L78">    BankHelper.checkIfValidAmount(amount);</span>
<span class="fc" id="L79">    this.balance += amount;</span>
<span class="fc" id="L80">  }</span>

  /**
   * Deposits the given amount in to the account. Also adds this transaction to the transaction
   * history.
   *
   * @param amount the amount to be deposited
   * @throws IllegalArgumentException if the given amount is negative
   */
  public void deposit(double amount) {
<span class="fc" id="L90">    BankHelper.checkIfValidAmount(amount);</span>
<span class="fc" id="L91">    this.balance += amount;</span>
<span class="fc" id="L92">    addToTransactionHistory(new Transaction(null, this, amount));</span>
<span class="fc" id="L93">  }</span>

  /**
   * Withdraws the given amount from the account. Also adds this transaction to the transaction
   * history.
   *
   * @param amount the amount to be withdrawn
   * @throws IllegalArgumentException if the given amount is negative
   * @throws IllegalStateException if the withdrawal of the amount leads to the balance 
   *        being negative
   */
  public void withdraw(double amount) {
<span class="fc" id="L105">    BankHelper.checkIfValidAmount(amount);</span>
<span class="fc" id="L106">    BankHelper.checkIfValidBalance(-amount, this);</span>
<span class="fc" id="L107">    this.balance -= amount;</span>
<span class="fc" id="L108">    addToTransactionHistory(new Transaction(this, null, amount));</span>
<span class="fc" id="L109">  }</span>

  /**
   * This method is only to be used when another account is transfering money to 
   * this account and the money transferred neads to be added to the balance.
   *
   * @param amount amount to be recieved
   */
  private void recieveFromOtherAccount(double amount) {
<span class="fc" id="L118">    BankHelper.checkIfValidAmount(amount);</span>
<span class="fc" id="L119">    balance += amount;</span>
<span class="fc" id="L120">  }</span>

  /**
   * Transfers the spesified amount of money from this account to the recipient account. Also adds
   * this transaction to both the payers and the recipients transaction history
   *
   * @param recievingAccount the account that will recieve the money
   * @param amount the amount of money to be transferred to the recipient account
   * @throws IllegalArgumentException if the amount is negative
   * @throws IllegalArgumentException if 'recievingAccount' is {@code null}
   * @throws IllegalArgumentException if 'recievingAccount' is the account that is also transfering
   *         the money
   * @throws IllegalStateException if the balance is less than 0 when the amount is added
   */
  public void transfer(AbstractAccount recievingAccount, double amount) {
<span class="fc" id="L135">    BankHelper.checkIfValidAmount(amount);</span>
<span class="fc" id="L136">    BankHelper.checkIfValidBalance(-amount, this);</span>
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">    if (recievingAccount == null) {</span>
<span class="nc" id="L138">      throw new IllegalArgumentException(&quot;The parameter 'recievingAccount' cannot be 'null'&quot;);</span>
    }
<span class="pc bpc" id="L140" title="1 of 2 branches missed.">    if (recievingAccount == this) {</span>
<span class="nc" id="L141">      throw new IllegalArgumentException(&quot;The parameter 'recievingAccount' cannot be itself&quot;);</span>
    }
<span class="pc bpc" id="L143" title="1 of 4 branches missed.">    if (recievingAccount instanceof BsuAccount &amp;&amp; recievingAccount.getBalance() </span>
        + amount &gt; 25000) {
<span class="fc" id="L145">      throw new IllegalStateException(</span>
          &quot;The Bsu account's balance cannot exceed '25000', but was: &quot; 
<span class="fc" id="L147">              + recievingAccount.getBalance() + amount);</span>
    }
    // deducts the amount from this accounts balance
<span class="fc" id="L150">    balance -= amount;</span>
    // adds the amount to the recipient accounts balance 
<span class="fc" id="L152">    recievingAccount.recieveFromOtherAccount(amount); </span>
<span class="fc" id="L153">    Transaction transfer = new Transaction(this, recievingAccount, amount);</span>
<span class="fc" id="L154">    addToTransactionHistory(transfer);</span>
<span class="fc" id="L155">    recievingAccount.addToTransactionHistory(transfer);</span>
<span class="fc" id="L156">  }</span>

  /**
   * Goes through all the users account numbers starting from 1000 and going up to 9999, 
   * checking for available account numbers.
   *
   * @param user the user to check
   * @return the available account number, {@code -1} if no available account number,
   *          or {@code 1000} if the user is {@code null}.
   */
  private int getNextAvailableAccountNumber(User user) {
<span class="fc bfc" id="L167" title="All 2 branches covered.">    if (user != null) {</span>
      // looping through the possible account numbers
<span class="fc bfc" id="L169" title="All 2 branches covered.">      for (int accountNumber = 1000; accountNumber &lt; 10000; accountNumber++) { </span>
        // checking if its taken
<span class="fc bfc" id="L171" title="All 2 branches covered.">        if (!user.getAccountNumbers().contains(accountNumber)) { </span>
<span class="fc" id="L172">          return accountNumber;</span>
        }
      }
<span class="fc" id="L175">      return -1; // return -1 if all the account numbers are taken</span>
    }
<span class="fc" id="L177">    return 1000; // if the user is null return 1000</span>
  }

  /**
   * Adds a transaction to the accounts transaction history.
   *
   * @param transaction the transaction to add
   * @return {@code true} if the transaction was added
   */
  public boolean addToTransactionHistory(Transaction transaction) {
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">    if (transaction != null) {</span>
<span class="fc" id="L188">      return (transactionHistory.add(transaction));</span>
    }
<span class="nc" id="L190">    return false;</span>

  }

  // ==============================================================================================
  // Getters and setters
  // ==============================================================================================

  public double getBalance() {
<span class="fc" id="L199">    return balance;</span>
  }

  public int getAccountNumber() {
<span class="fc" id="L203">    return accountNumber;</span>
  }

  public String getName() {
<span class="fc" id="L207">    return name;</span>
  }

  /**
   * Returns the ID number of the owner.
   *
   * @return the ID number of the owner, or {@code -1} if the owner is {@code null}.
   */
  public int getOwnerId() {
<span class="pc bpc" id="L216" title="1 of 2 branches missed.">    if (owner == null) {</span>
<span class="nc" id="L217">      return -1;</span>
    }
<span class="fc" id="L219">    return owner.getUserId();</span>
  }

  public List&lt;Transaction&gt; getTransactionHistory() {
<span class="fc" id="L223">    return new ArrayList&lt;&gt;(transactionHistory);</span>
  }

  /**
   * Changes the name of the account. Name must be 20 characters or less,
   * and can only consist of letters and spaces.
   *
   * @param name the name you wish to change to
   * @throws IllegalArgumentException if the name is more than 20 characters long, 
   *         or does not only contain letters and spaces
   */
  public void setName(String name) {
<span class="fc" id="L235">    BankHelper.checkIfValidName(name);</span>
<span class="fc" id="L236">    this.name = name;</span>
<span class="fc" id="L237">  }</span>

  /**
   * Sets the owner of the account. The account cannot go from having an owner
   * to not having an owner. Therefore if the owner parameter is null, 
   * this method does nothing.
   *
   * @param owner the owner to set
   */
  public void setOwner(User owner) {
<span class="fc bfc" id="L247" title="All 2 branches covered.">    if (owner != null) {</span>
<span class="fc" id="L248">      owner.addAccount(this);</span>
<span class="fc" id="L249">      this.owner = owner;</span>
    }
<span class="fc" id="L251">  }</span>

  @Override
  public String toString() {
<span class="fc" id="L255">    return &quot;Name: &quot; + getName() + &quot;\nAccount number: &quot; + getAccountNumber() </span>
<span class="fc" id="L256">        + &quot;\nOwner (ID): &quot; + owner.getName() + &quot; (&quot;</span>
<span class="fc" id="L257">        + owner.getUserId() + &quot;)&quot; + &quot;\nBalance: &quot; + getBalance();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>